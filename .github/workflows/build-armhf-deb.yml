name: Build and Run ARMhf Hello

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  build-and-run:
    name: Build and Run on ARMhf (via Docker/QEMU)
    runs-on: ubuntu-24.04-arm

    steps:
      - name: Checkout source
        uses: actions/checkout@v4

      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3
        with:
          platforms: arm

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build ARMhf Docker image (DEB installed)
        uses: docker/build-push-action@v5
        with:
          context: .
          platforms: linux/arm/v7
          file: docker/Dockerfile
          outputs: type=docker
          tags: hello-armhf:test

      - name: Run container and test /usr/bin/hello
        run: |
          docker run --rm --platform linux/arm/v7 hello-armhf:test